# Project Roadmap & Task Backlog

This document tracks planned features and technical improvements to ensure continuity across development sessions.

## High Priority
- [ ] **How To Reset Cultivars:** As we start experimenting with adding Cultivars we will likely need to remove them and try something different. We need an easy way to reset the DB back to the state after WCVP was loaded and before we add non-WCVP plants, such as Cultivars.
- [ ] **Fix Finding Plant Details:** The Icon Button for searching for plant details doesn't function. Also the Icon is not obvious what it does. I'm not sure which of the two Icons to select but neither works. The Icon button needs a tool tip saying what it does.
- [ ] **Fix Missing Controls for Adding Plants:** Currently there is nothing in the UI to add plants. During early prototyping phase we had ability to add a single plant by searching for a name that didn't exist in the app and also ability to upload a file with plant information.

## Medium Priority
- [ ] **Cache Limits:** If we keep scrolling in the grid it will continue to load more and more plants. We should have a caching scheme that can expire earlier loaded plants at some point. If the user scrolls back to to the top it would recache those that expired so that from the user's perspective it is continuous.
- [ ] **Fetch During Collapsed Tree View** When the grid is in tree view and it is collapsed to a partular level (1,2,3,etc.) where only a few plans are displayed then fetch more plants to ayt least fill the display and allow scrolling to fetch/load even more. 
- [ ] **Virtual Row for Generic  Cultivars:** Add a virtual group under Genus to hold generic cultivars. Use something like "---" or "(none)", etc. in the Species column. Not sure if they should sort before or after the other Species. Maybe do a similar thing for the Cultivars of Species, adding a fake group named "---" or "(none)" in the Infraspecies column?
- [ ] **Activity Panel Updates** The Activity Panel still does not allow optimizing the size of the three sections for maximum viewability. The items on the Activity Panel need to capture more context of the process in order to know what was done, and to test the results are what is expected and to debug when things aren't.
- [ ] **Build Out Details Panel:** It would show all the data for the plant organized in sections. At least any sections with a lot of information is collapsable. Include origin, history, background. Include growing conditions. Include A.K.K section. Include Physical Description section. Give it an edit mode so data can be updated (for those with the correct role).
- [ ] **Inheriting from Parents:** Since lower level taxons are a specialization of the parent can they inherit certain attributes (descriptive) if those attributes are not set an the child? This would not include things like status or authorship but would include climate, geography and lifeform. May want to make it clear to the user when a description is inherited (inherited) vs specific (specialized) to that taxon.
- [ ] **Redirecting to Accepted Taxon:** Need to figure out how to handle if someone searches/filters on a synonym, how to best direct them to the accepted taxa. Would be nice if it was done automatically. Would need to explain to the user since there would be a context shift. Might want to have synonyms (and other related taxa) show up as another level in the tree, below the accepted taxa. Or this could just be on the details panel.
- [ ] **A.K.A. in Details Panel:** Update the SynonymType under types.ts to be AKATypes with values to cover WCVP Accepted, WCVP synonyms, trade names, trademarks, registered trademarks, patents, common names, Other Cultivars, misapplied, commonly misrepresented, unspecified, etc.  The Details Panel would have a collapsable section called "A.K.A". There would be a way to easily distinguish the AKATypes of the entries. If this taxon has an acceptedPlantNameId then the Taxon Name of it is shown with a link to that entry. If there are other plants with this acceptedPlantNameId for this plant then their Taxon Name is shown with a link to that entry. Include references to reputable websites. Include brief quotes about plants from reputable sources, with proper citing and references to the source. Follow guidance provided by Google AI - see document of session conversation.
- [ ] **Physical Description:**  Include as a section in the Details Panel. Include things like plant size-Height/width, growth rate, Plant shape, plant overall texture, floliage shape, foliage size, foliage texture, foliage color, variation throughout the year, Flowering period, flower color and description, description of base/rooting system- type (bulb, rhizonme, etc.), size, shape, etc. Also include special characteristics for the type of plant it is.

## Low Priority
- [ ] **Index Expansion:** Add indices to all filterable columns in `app_taxa` to prevent 57014 Database Timeouts during complex grid filtering.
- [ ] **3-Tier Architecture Transition:** Move database logic to a dedicated server/API layer to support scaling beyond free-tier and browser limitations.
- [ ] **Infrastructure Maintenance:** Address the need for a paid Supabase plan as the database exceeds logical storage limits (~1.9GB currently).
- [ ] **Lifeform Multiselect Filter:** Create a multiselect filter for the lifeform_description column (which uses the Raunkiær terminology). Previous exact-match implementation (v2.18.2) proved insufficient for complex Raunkiær strings. Future implementation requires case-insensitive substring search or GIN-index support. Nice to have would be an extension to allow logical AND. Another nice to have extension would handle filtering based on logical subtypes and descritptive terms.
- [ ] **User Authentication:** Use the Supabase Authentication for end users. Turn on RLS. Use correct API Key (not anon).
- [ ] **Create Role Based Access:** Start with at least a readonly and a read/write (or admin) role. In future expand role to allow adding Cultivars and editing those that you add. Possibly this would be a role tied to particular plant types (e.g. conifers or succulents) or specific taxon layers (Acer palmatum or Hosta). Possibly another future role to add Genus, Species and Infraspecies.
- [ ] **Architect as 3 Tier App:** Makre sure this can run as a 3 tier app, even though testing in AI Studio would be running both a server and client tiers. What are options for where to run the server tier for a web application? What is the path to production? Automate as much as possible.
- [ ] **Offline Storage:** Use PouchDB/IndexedDB to allow full cataloging without an internet connection, syncing when online.
- [ ] **Export/Import:** Implement CSV/Excel export for the current filtered view in the Data Grid.
- [ ] **Real-time Sync:** Implement Supabase `REALTIME` listeners to update the grid automatically when background mining processes finish.
- [ ] **Image Integration:** Add support for `imageConfig` in Gemini to generate or fetch botanical illustrations for the `app_taxon_details` view.
- [ ] **Hybrid Formula Builder:** A UI tool to help users select two existing taxa to create a new Hybrid record with a valid `hierarchy_path`.
- [ ] **Advanced Filtering:** Add "Range" filters for numerical columns like `firstPublished`.
- [ ] **Geographic Mapping:** Use Gemini Maps Grounding to convert the `geographicArea` text strings into interactive map markers.
- [ ] **Extending Genus, Species, Infraspecies:** There is a lot of work done outside of WCVP that identifies plants which may eventually be adopted in WCVP. At this time I have not concluded whether to allow adding these to the app. First question is if we allowed adding Genus, Species and Infraspscies that are not in WCVP does this design support that or if it doesn't would it be difficult to add later?

## Technical Debt / Polish
- [ ] **Mobile Responsiveness:** The Data Grid is currently optimized for desktop; implement a "Card View" fallback for mobile screens.
- [ ] **Query Optimization:** Move the "Hierarchy Path" calculation to a Postgres Trigger to remove the need for Step 7 in the manual build process.
- [ ] **Error Handling:** Add a global Error Boundary and more granular toast notifications for AI service timeouts.


## Archive
- [x] (Done) **Fix Core Filter Dropdowns:** Standardized ranks, status and infraspecific ranks used in grid filter. Documented in `docs/FILTER_STRATEGIES.md`. Options and UI elements now match database capitalization exactly, utilizing `normal-case` to override header inheritance.
- [x] (Done) **Fix Climate Filter:** Restored specific small-case literals to match DB data. Added documentation regarding case sensitivity and capitalization standards.
- [x] (Done) **Lifeform Filter as Text:** Change the Lifeform filter back to just text instead of a multi-select.
- [x] (Done) **Stop Grid Flash** [AI Note: Stabilized DataGrid mounting logic in App.tsx to prevent unmounting when filters result in zero rows or when background fetches occur. Preservation of focus and dropdown state verified in code.]
- [x] (Done) **Unselect All Columns:** (Fixed - Pending User Verification) [AI Note: Added "Hide All" button next to "Show All" in the Column Picker menu in DataGrid.tsx.]
- [x] (Done) **Fix Genus Column for Family:** (Fixed - Pending User Verification) [AI Note: Updated getRowValue in DataGrid.tsx to return an empty string for the 'genus' column when taxonRank is 'Family'. Standardized virtual rank casing to Title Case (e.g., 'Family') for visual consistency in the Rank column.]
- [x] (Done) **Optimize Filtering:** Review the rules used for dynamic filtering in dataService.ts, for different columns. Some use 'like', some use 'is', some use 'in', some convert to lower case, some capitalize the first letter, etc. Optimize which method to use for each column. [AI Note: Implemented Hybrid Search Engine toggle in DataGrid.tsx and dataService.ts, allowing users to switch between optimized B-Tree Prefix search and Trigram GIN Fuzzy search. Standardized Rank, Status, and Climate filters to match exact database literals with 'normal-case' UI overrides to prevent case-mismatch errors. Added Intelligent Auto-Casing in dataService.ts to automatically format Family/Genus (Title Case) and Species/Infraspecies (Lowercase) search strings to ensure B-Tree index hits.]
- [x] (Done) **Fix 57014 Errors:** [AI Note: Implemented UX mitigations to handle "Database timeout (57014)" errors. Added "Commit-on-Enter" requirement for technical columns (IDs, Dates) to prevent expensive partial-match queries while typing. Added a persistent error badge in the grid header and refined `App.tsx` logic to keep the grid mounted during errors, ensuring the UI remains interactive so users can correct filters.]